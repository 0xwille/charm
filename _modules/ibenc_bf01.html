

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ibenc_bf01 &mdash; Charm-Crypto 0.4b documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.4b',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Charm-Crypto 0.4b documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">Charm-Crypto 0.4b documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for ibenc_bf01</h1><pre>
  
| From: "D. Boneh, M. Franklin Identity-Based Encryption from the Weil Pairing", Section 4.2.
| Published in: Crypto 2003
| Available from: http://.../bfibe.pdf
| Notes: This is the IBE .

* type:           encryption (identity-based)
* setting:        bilinear groups (asymmetric)

:Authors:    J. Ayo Akinyele
:Date:       2/2011
'''
from toolbox.pairinggroup import PairingGroup,ZR,G1,G2,pair
from toolbox.hash_module import Hash,int2Bytes,integer
from toolbox.IBEnc import IBEnc

debug = False
class IBE_BonehFranklin(IBEnc):
    def __init__(self, groupObj):
<div class="viewcode-block" id="IBE_BonehFranklin"><a class="viewcode-back" href="../schemes/ibenc_bf01.html#ibenc_bf01.IBE_BonehFranklin">[docs]</a>        IBEnc.__init__(self)
        global group,h,ZN
        group = groupObj
        h = Hash('sha1', group)
        ZN = -1
        
    def setup(self):
        s, P = group.random(), group.random(G2)
<div class="viewcode-block" id="IBE_BonehFranklin.setup"><a class="viewcode-back" href="../schemes/ibenc_bf01.html#ibenc_bf01.IBE_BonehFranklin.setup">[docs]</a>        P2 = s * P
        # choose H1, H2 hash functions
        pk = { 'P':P, 'P2':P2 }
        sk = { 's':s }
        if(debug):
            print("Public parameters...")
            group.debug(pk)
            print("Secret parameters...")
            group.debug(sk)
        return (pk, sk)
    
    def extract(self, sk, ID):        
        d_ID = sk['s'] * group.hash(ID, G1)</div>
<div class="viewcode-block" id="IBE_BonehFranklin.extract"><a class="viewcode-back" href="../schemes/ibenc_bf01.html#ibenc_bf01.IBE_BonehFranklin.extract">[docs]</a>        k = { 'id':d_ID }
        if(debug):
            print("Key for id =&gt; '%s'" % ID)
            group.debug(k)
        return k
        
    
    def encrypt(self, pk, ID, M): # check length to make sure it is within n bits
        Q_id = group.hash(ID, G1) #standard</div>
<div class="viewcode-block" id="IBE_BonehFranklin.encrypt"><a class="viewcode-back" href="../schemes/ibenc_bf01.html#ibenc_bf01.IBE_BonehFranklin.encrypt">[docs]</a>        g_id = pair(Q_id, pk['P2']) 
        #choose sig = {0,1}^n where n is # bits
        sig = group.random(ZN)
        r = h.hashToZr(sig, M)

        enc_M = self.encodeToZn(M)
        if group.validSize(enc_M):
            C = { 'U':r * pk['P'], 'V':sig ^ h.hashToZn(g_id ** r) , 'W':enc_M ^ h.hashToZn(sig) }
        else:
            print("Message cannot be encoded.")
            return None

        if(debug):
            print('\nEncrypt...')
            print('r =&gt; %s' % r)
            print('sig =&gt; %s' % sig)
            print("V'  =&gt;", g_id ** r)
            print('enc_M =&gt; %s' % enc_M)
            group.debug(C)
        return C
    
    def decrypt(self, pk, sk, ct):
        U, V, W = ct['U'], ct['V'], ct['W']</div>
<div class="viewcode-block" id="IBE_BonehFranklin.decrypt"><a class="viewcode-back" href="../schemes/ibenc_bf01.html#ibenc_bf01.IBE_BonehFranklin.decrypt">[docs]</a>        sig = V ^ h.hashToZn(pair(sk['id'], U))
        dec_M = W ^ h.hashToZn(sig)
        M = self.decodeFromZn(dec_M)

        r = h.hashToZr(sig, M)
        if(debug):
            print('\nDecrypt....')
            print('V   =&gt;', V)
            print("V'  =&gt;", pair(sk['id'], U))
            print('sig =&gt; %s' % sig)
            print('r =&gt; %s' % r)
        if U == r * pk['P']:
            if debug: print("Successful Decryption!!!")
            return M
        if debug: print("Decryption Failed!!!")
        return None

    def encodeToZn(self, message):
        return integer(message)</div>
<div class="viewcode-block" id="IBE_BonehFranklin.encodeToZn"><a class="viewcode-back" href="../schemes/ibenc_bf01.html#ibenc_bf01.IBE_BonehFranklin.encodeToZn">[docs]</a>        
    def decodeFromZn(self, element):
        if type(element) == integer:</div>
<div class="viewcode-block" id="IBE_BonehFranklin.decodeFromZn"><a class="viewcode-back" href="../schemes/ibenc_bf01.html#ibenc_bf01.IBE_BonehFranklin.decodeFromZn">[docs]</a>            msg = int2Bytes(element)
            return bytes.decode(msg, 'utf8') # convert back to string
        return None
     

def main():
    groupObj = PairingGroup('MNT224', 1024)    </div></div>
<div class="viewcode-block" id="main"><a class="viewcode-back" href="../schemes/ibenc_bf01.html#ibenc_bf01.main">[docs]</a>    ibe = IBE_BonehFranklin(groupObj)
    
    (pk, sk) = ibe.setup()
    
    id = 'ayo@email.com'
    key = ibe.extract(sk, id)
    
    m = "hello world!!!!!"
    ciphertext = ibe.encrypt(pk, id, m)

    msg = ibe.decrypt(pk, key, ciphertext)
    assert msg == m,  "failed decrypt: \n%s\n%s" % (msg, m)
    if debug: print("Successful Decryption!!!")
    
        
if __name__ == "__main__":
    debug = True</div>
    main()
</pre>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">Charm-Crypto 0.4b documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Johns Hopkins University ISI.
      Last updated on Feb 19, 2012.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1pre.
    </div>
  </body>
</html>